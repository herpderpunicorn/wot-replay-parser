#include <gtest/gtest.h>
#include <json/json.h>
#include "../BattleResult.hpp"

using namespace WotReplayParser;

TEST(BattleResult, Parse) {
    BattleResult battleResult;
    std::string valid(R"({"personal":{"spotted":1,"repair":23877,"xpPenalty":0,"creditsPenalty":0,"vehTypeLockTime":0,"damageAssistedTrack":0,"killerID":36326450,"originalFreeXP":4,"directTeamHits":0,"damageDealt":1903,"creditsToDraw":0,"movingAvgDamage":0,"piercingsReceived":4,"sniperDamageDealt":1903,"premiumCreditsFactor10":15,"damageAssistedRadio":0,"orderXP":0,"marksOnGun":0,"piercings":6,"damageBlockedByArmor":0,"premiumXPFactor10":15,"serviceProviderID":0,"xp":121,"droppedCapturePoints":0,"creditsContributionIn":0,"eventFreeXP":0,"directHitsReceived":4,"autoRepairCost":23877,"typeCompDescr":12305,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"eventTMenXP":121,"aogasFactor10":10,"histAmmoCost":[0,0],"orderTMenXP":0,"eventCredits":0,"health":0,"details":{"36326457":{"spotted":0,"crits":0,"damageAssistedTrack":0,"fire":0,"deathReason":-1,"damageDealt":0,"damageAssistedRadio":0,"piercings":0,"explosionHits":0,"directHits":1},"36326442":{"spotted":1,"crits":16777218,"damageAssistedTrack":0,"fire":0,"deathReason":0,"damageDealt":1118,"damageAssistedRadio":0,"piercings":3,"explosionHits":0,"directHits":3},"36326459":{"spotted":0,"crits":16,"damageAssistedTrack":0,"fire":0,"deathReason":-1,"damageDealt":0,"damageAssistedRadio":0,"piercings":1,"explosionHits":0,"directHits":1},"36326450":{"spotted":0,"crits":65554,"damageAssistedTrack":0,"fire":0,"deathReason":-1,"damageDealt":785,"damageAssistedRadio":0,"piercings":2,"explosionHits":0,"directHits":2}},"isPrematureLeave":false,"orderCredits":0,"damageRating":0,"achievementCredits":0,"achievements":[],"orderFreeXP":0,"isPremium":true,"mileage":1391,"freeXP":6,"shots":8,"kills":1,"fortResource":null,"dossierPopUps":[],"damaged":3,"tdamageDealt":0,"credits":13641,"eventGold":0,"igrXPFactor10":10,"markOfMastery":0,"noDamageDirectHitsReceived":0,"autoEquipCost":[5000,0],"gold":0,"accountDBID":500595340,"isTeamKiller":false,"tmenXP":242,"eventXP":0,"tkills":0,"potentialDamageReceived":2390,"damageReceived":2050,"orderFortResource":0,"autoLoadCost":[9600,0],"originalCredits":9094,"dailyXPFactor10":10,"explosionHits":0,"team":1,"originalXP":81,"lifeTime":278,"questsProgress":{"EU_05-08_Jul_2014_q4":[null,{"bonusCount":11},{"bonusCount":12}]},"creditsContributionOut":0,"achievementFreeXP":0,"directHits":7},"players":{"500346112":{"name":"mara24","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"503987456":{"name":"petrkasp","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"516849800":{"name":"Jarda205","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"502800777":{"name":"JuneScapula","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"502525962":{"name":"belBOSS","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"500595340":{"name":"ZnakE","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"506993261":{"name":"Pauliskhan","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"513801454":{"name":"6BackInBlack9","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"503506223":{"name":"inph","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"503040338":{"name":"w_morder","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"503345779":{"name":"riddik76","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"504248373":{"name":"Maros20","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"509677769":{"name":"CZwOK","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"506087626":{"name":"TheLakaBossCZE","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"507992345":{"name":"BurgersUK","prebattleID":35959496,"igrType":0,"clanAbbrev":"RDDT","team":1,"clanDBID":500003668},"512746043":{"name":"69Gela69","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"504281020":{"name":"lancer8","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645},"501169565":{"name":"FidelCZ","prebattleID":35959496,"igrType":0,"clanAbbrev":"CSOH","team":2,"clanDBID":500045645}},"vehicles":{"36326442":{"spotted":3,"damageAssistedTrack":0,"killerID":36326447,"directTeamHits":0,"damageDealt":0,"piercingsReceived":5,"sniperDamageDealt":0,"damageAssistedRadio":0,"piercings":0,"damageBlockedByArmor":0,"xp":400,"droppedCapturePoints":0,"directHitsReceived":5,"typeCompDescr":3649,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":3141,"shots":0,"kills":0,"fortResource":null,"damaged":0,"tdamageDealt":0,"credits":15763,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":500346112,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":1810,"damageReceived":1800,"explosionHits":0,"team":2,"lifeTime":238,"achievementFreeXP":0,"directHits":0},"36326443":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":496,"piercingsReceived":2,"sniperDamageDealt":496,"damageAssistedRadio":0,"piercings":2,"damageBlockedByArmor":400,"xp":441,"droppedCapturePoints":0,"directHitsReceived":3,"typeCompDescr":7169,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":1798,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1287,"shots":6,"kills":0,"fortResource":null,"damaged":2,"tdamageDealt":0,"credits":18963,"noDamageDirectHitsReceived":1,"gold":0,"accountDBID":503987456,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":800,"damageReceived":352,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":4},"36326444":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":841,"piercingsReceived":2,"sniperDamageDealt":443,"damageAssistedRadio":0,"piercings":3,"damageBlockedByArmor":400,"xp":523,"droppedCapturePoints":0,"directHitsReceived":3,"typeCompDescr":11521,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":821,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1765,"shots":6,"kills":0,"fortResource":null,"damaged":3,"tdamageDealt":0,"credits":20552,"noDamageDirectHitsReceived":1,"gold":0,"accountDBID":516849800,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":1200,"damageReceived":879,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":4},"36326445":{"spotted":2,"damageAssistedTrack":0,"killerID":36326457,"directTeamHits":0,"damageDealt":325,"piercingsReceived":3,"sniperDamageDealt":0,"damageAssistedRadio":210,"piercings":1,"damageBlockedByArmor":0,"xp":33,"droppedCapturePoints":0,"directHitsReceived":3,"typeCompDescr":16897,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":2514,"shots":1,"kills":0,"fortResource":null,"damaged":1,"tdamageDealt":0,"credits":4715,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":502800777,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2590,"damageReceived":1900,"explosionHits":0,"team":1,"lifeTime":295,"achievementFreeXP":0,"directHits":1},"36326446":{"spotted":0,"damageAssistedTrack":0,"killerID":36326458,"directTeamHits":0,"damageDealt":2735,"piercingsReceived":4,"sniperDamageDealt":1121,"damageAssistedRadio":0,"piercings":9,"damageBlockedByArmor":3450,"xp":116,"droppedCapturePoints":0,"directHitsReceived":9,"typeCompDescr":10785,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":2016,"shots":18,"kills":0,"fortResource":null,"damaged":5,"tdamageDealt":0,"credits":12257,"noDamageDirectHitsReceived":5,"gold":0,"accountDBID":502525962,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":5740,"damageReceived":2200,"explosionHits":0,"team":1,"lifeTime":539,"achievementFreeXP":0,"directHits":14},"36326447":{"spotted":1,"damageAssistedTrack":0,"killerID":36326450,"directTeamHits":0,"damageDealt":1903,"piercingsReceived":4,"sniperDamageDealt":1903,"damageAssistedRadio":0,"piercings":6,"damageBlockedByArmor":0,"xp":81,"droppedCapturePoints":0,"directHitsReceived":4,"typeCompDescr":12305,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1391,"shots":8,"kills":1,"fortResource":null,"damaged":3,"tdamageDealt":0,"credits":9094,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":500595340,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2390,"damageReceived":2050,"explosionHits":0,"team":1,"lifeTime":278,"achievementFreeXP":0,"directHits":7},"36326448":{"spotted":4,"damageAssistedTrack":0,"killerID":36326457,"directTeamHits":0,"damageDealt":5192,"piercingsReceived":5,"sniperDamageDealt":4712,"damageAssistedRadio":0,"piercings":13,"damageBlockedByArmor":1940,"xp":156,"droppedCapturePoints":0,"directHitsReceived":7,"typeCompDescr":10785,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1299,"shots":19,"kills":0,"fortResource":null,"damaged":7,"tdamageDealt":0,"credits":21036,"noDamageDirectHitsReceived":2,"gold":0,"accountDBID":503040338,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":4980,"damageReceived":2200,"explosionHits":0,"team":1,"lifeTime":557,"achievementFreeXP":0,"directHits":16},"36326449":{"spotted":0,"damageAssistedTrack":0,"killerID":36326458,"directTeamHits":0,"damageDealt":0,"piercingsReceived":3,"sniperDamageDealt":0,"damageAssistedRadio":399,"piercings":0,"damageBlockedByArmor":980,"xp":33,"droppedCapturePoints":0,"directHitsReceived":5,"typeCompDescr":13569,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1920,"shots":5,"kills":0,"fortResource":null,"damaged":0,"tdamageDealt":0,"credits":2721,"noDamageDirectHitsReceived":2,"gold":0,"accountDBID":507992345,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":3320,"damageReceived":1950,"explosionHits":0,"team":1,"lifeTime":518,"achievementFreeXP":0,"directHits":3},"36326450":{"spotted":2,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":1845,"piercingsReceived":4,"sniperDamageDealt":1845,"damageAssistedRadio":620,"piercings":2,"damageBlockedByArmor":0,"xp":554,"droppedCapturePoints":0,"directHitsReceived":4,"typeCompDescr":9297,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":454,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1341,"shots":2,"kills":1,"fortResource":null,"damaged":2,"tdamageDealt":0,"credits":24537,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":501169565,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":1580,"damageReceived":1546,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":2},"36326451":{"spotted":0,"damageAssistedTrack":0,"killerID":36326455,"directTeamHits":0,"damageDealt":774,"piercingsReceived":2,"sniperDamageDealt":774,"damageAssistedRadio":411,"piercings":1,"damageBlockedByArmor":2030,"xp":39,"droppedCapturePoints":0,"directHitsReceived":5,"typeCompDescr":13857,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1096,"shots":3,"kills":0,"fortResource":null,"damaged":1,"tdamageDealt":0,"credits":5307,"noDamageDirectHitsReceived":3,"gold":0,"accountDBID":506993261,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":4130,"damageReceived":2050,"explosionHits":0,"team":1,"lifeTime":386,"achievementFreeXP":0,"directHits":1},"36326452":{"spotted":1,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":1496,"piercingsReceived":1,"sniperDamageDealt":1496,"damageAssistedRadio":1272,"piercings":2,"damageBlockedByArmor":1900,"xp":557,"droppedCapturePoints":0,"directHitsReceived":4,"typeCompDescr":13857,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":1276,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":762,"shots":7,"kills":0,"fortResource":null,"damaged":2,"tdamageDealt":0,"credits":26293,"noDamageDirectHitsReceived":3,"gold":0,"accountDBID":513801454,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2650,"damageReceived":774,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":3},"36326453":{"spotted":4,"damageAssistedTrack":0,"killerID":36326456,"directTeamHits":0,"damageDealt":995,"piercingsReceived":4,"sniperDamageDealt":652,"damageAssistedRadio":696,"piercings":4,"damageBlockedByArmor":0,"xp":66,"droppedCapturePoints":0,"directHitsReceived":4,"typeCompDescr":16897,"explosionHitsReceived":0,"achievementXP":0,"deathReason":0,"capturePoints":0,"health":0,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1965,"shots":4,"kills":0,"fortResource":null,"damaged":3,"tdamageDealt":0,"credits":8540,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":503506223,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2470,"damageReceived":1900,"explosionHits":0,"team":1,"lifeTime":290,"achievementFreeXP":0,"directHits":4},"36326454":{"spotted":1,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":0,"piercingsReceived":5,"sniperDamageDealt":0,"damageAssistedRadio":248,"piercings":0,"damageBlockedByArmor":0,"xp":430,"droppedCapturePoints":0,"directHitsReceived":5,"typeCompDescr":7169,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":163,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1057,"shots":2,"kills":0,"fortResource":null,"damaged":0,"tdamageDealt":0,"credits":17087,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":503345779,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2000,"damageReceived":1987,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":1},"36326455":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":2071,"piercingsReceived":4,"sniperDamageDealt":1001,"damageAssistedRadio":0,"piercings":2,"damageBlockedByArmor":0,"xp":582,"droppedCapturePoints":0,"directHitsReceived":4,"typeCompDescr":12049,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":709,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1571,"shots":5,"kills":1,"fortResource":null,"damaged":2,"tdamageDealt":0,"credits":26353,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":504248373,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":1440,"damageReceived":1491,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":2},"36326456":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":568,"piercingsReceived":4,"sniperDamageDealt":0,"damageAssistedRadio":0,"piercings":2,"damageBlockedByArmor":800,"xp":530,"droppedCapturePoints":0,"directHitsReceived":5,"typeCompDescr":7169,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":1012,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1624,"shots":6,"kills":1,"fortResource":null,"damaged":1,"tdamageDealt":0,"credits":20507,"noDamageDirectHitsReceived":1,"gold":0,"accountDBID":509677769,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":2000,"damageReceived":1138,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":3},"36326457":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":3744,"piercingsReceived":2,"sniperDamageDealt":2200,"damageAssistedRadio":620,"piercings":5,"damageBlockedByArmor":710,"xp":712,"droppedCapturePoints":0,"directHitsReceived":3,"typeCompDescr":12049,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":1825,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1468,"shots":7,"kills":2,"fortResource":null,"damaged":5,"tdamageDealt":0,"credits":37448,"noDamageDirectHitsReceived":1,"gold":0,"accountDBID":512746043,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":1110,"damageReceived":375,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":7},"36326458":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":1733,"piercingsReceived":0,"sniperDamageDealt":719,"damageAssistedRadio":0,"piercings":3,"damageBlockedByArmor":0,"xp":632,"droppedCapturePoints":0,"directHitsReceived":0,"typeCompDescr":9489,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":2700,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":554,"shots":6,"kills":2,"fortResource":null,"damaged":3,"tdamageDealt":0,"credits":28959,"noDamageDirectHitsReceived":0,"gold":0,"accountDBID":504281020,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":0,"damageReceived":0,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":4},"36326459":{"spotted":0,"damageAssistedTrack":0,"killerID":0,"directTeamHits":0,"damageDealt":1456,"piercingsReceived":5,"sniperDamageDealt":451,"damageAssistedRadio":3655,"piercings":4,"damageBlockedByArmor":2350,"xp":671,"droppedCapturePoints":0,"directHitsReceived":10,"typeCompDescr":7169,"explosionHitsReceived":0,"achievementXP":0,"deathReason":-1,"capturePoints":0,"health":538,"isPrematureLeave":false,"achievementCredits":0,"achievements":[],"mileage":1575,"shots":11,"kills":0,"fortResource":null,"damaged":3,"tdamageDealt":0,"credits":41019,"noDamageDirectHitsReceived":5,"gold":0,"accountDBID":506087626,"isTeamKiller":false,"tkills":0,"potentialDamageReceived":3950,"damageReceived":1612,"explosionHits":0,"team":2,"lifeTime":562,"achievementFreeXP":0,"directHits":7}},"common":{"finishReason":1,"guiType":0,"arenaCreateTime":1404759963,"duration":562.70000000001,"arenaTypeID":13,"winnerTeam":2,"vehLockMode":0,"bonusType":5,"sortieDivision":null},"arenaUniqueID":1.3024332128786e+17})");
    Json::Reader reader;
    Json::Value value(Json::objectValue);
    ASSERT_TRUE(reader.parse(valid, value, false)) << "Unable to parse test json";
    battleResult.parse(Json::ValueType::objectValue);
}
